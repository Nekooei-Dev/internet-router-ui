<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/fontawesome.min.css">
  <!-- corrected static path -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('admin') }}">Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÛŒÙ†ØªØ±Ù†Øª</a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('settings') }}">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">ğŸšª Ø®Ø±ÙˆØ¬</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <h2 class="mb-4">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÛŒÙ†ØªØ±Ù†Øª</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h5>ğŸ‘¥ Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø§ÛŒÙ†ØªØ±Ù†Øª</h5>
    <table class="table table-striped table-bordered table-sm">
      <thead class="table-light">
        <tr>
          <th>IP</th>
          <th>MAC</th>
          <th>Host</th>
          <th>Ù†ÙˆØ¹ Ø§ÛŒÙ†ØªØ±Ù†Øª</th>
          <th>Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø±</th>
          <th>ØªÙˆØ¶ÛŒØ­</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for user in user_status_list %}
        <tr>
          <td>{{ user.ip }}</td>
          <td>{{ user.mac }}</td>
          <td>{{ user.host }}</td>
          <td>
            {% if user.routing_mark == 'main' %}
              Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            {% else %}
              {{ user.routing_mark }}
            {% endif %}
          </td>
          <td>
            {% if user.restricted %}
              âŒ ØºÛŒØ±ÙØ¹Ø§Ù„
            {% else %}
              âœ… ÙØ¹Ø§Ù„
            {% endif %}
          </td>
          <td>
            <form method="POST" class="d-flex gap-2">
              <input type="hidden" name="client_ip" value="{{ user.ip }}">
              <input type="text" name="new_label" value="{{ user.label or '' }}" class="form-control form-control-sm" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù„Ù¾â€ŒØªØ§Ù¾ Ù…Ø¯ÛŒØ±">
              <button type="submit" name="save_label" class="btn btn-sm btn-outline-secondary">ğŸ’¾</button>
            </form>
          </td>
          <td>
            <form method="POST" class="d-inline">
              <input type="hidden" name="client_ip" value="{{ user.ip }}">
              {% if user.routing_mark != 'main' %}
                <button type="submit" name="remove_internet" class="btn btn-sm btn-danger">Ø¨Ø§Ø²Ú¯Ø´Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
              {% endif %}
              {% if user.restricted %}
                <button type="submit" name="unblock_ip" class="btn btn-sm btn-success">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</button>
              {% else %}
                <button type="submit" name="block_ip" class="btn btn-sm btn-warning">ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</button>
              {% endif %}
            </form>

            {% if user.routing_mark != 'main' %}
              <form method="post" class="d-inline">
                <input type="hidden" name="delete_ip" value="{{ user.ip }}">
                <button type="submit" class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ Ù‡Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª {{ user.ip }} Ø­Ø°Ù Ø¨Ø´Ù‡ØŸ')">
                  Ø­Ø°Ù
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- ØªØºÛŒÛŒØ± Ø§ÛŒÙ†ØªØ±Ù†Øª Ú©Ø§Ø±Ø¨Ø± -->
    <form method="POST" class="mb-4">
      <h5>ğŸ” ØªØºÛŒÛŒØ± Ø§ÛŒÙ†ØªØ±Ù†Øª Ú©Ø§Ø±Ø¨Ø±</h5>
      <div class="row mb-2">
        <div class="col-md-4">
          <select class="form-select" name="client_ip">
            {% for lease in leases %}
              <option value="{{ lease.get('address', '') }}" {% if lease.get('address') == user_ip %}selected{% endif %}>
                {{ lease.get('host-name', '---') }} - {{ lease.get('mac-address', '---') }} - {{ lease.get('address', '---') }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <select name="new_internet" class="form-select">
            {% for table in tables %}
              {% if table.id != "main" %}
                <option value="{{ table.id }}">{{ table.name }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4 d-flex gap-2">
          <button type="submit" name="change_internet" class="btn btn-primary">ØªØºÛŒÛŒØ± Ø§ÛŒÙ†ØªØ±Ù†Øª</button>
          <button type="submit" name="remove_internet" class="btn btn-danger">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
        </div>
      </div>
    </form>

    <!-- ÙØ±Ù… Ø±ÙˆØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ -->
    <form method="POST" class="mb-4">
      <h5>ğŸŒ ØªØºÛŒÛŒØ± Ø§ÛŒÙ†ØªØ±Ù†Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶</h5>
      <div class="form-group">
        <label for="default_table">Ø§Ù†ØªØ®Ø§Ø¨ Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ Ø¨Ø±Ø§ÛŒ Ø±ÙˆØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶:</label>
        <select name="default_table" id="default_table" class="form-control">
          {% for iface_id, iface_name in interfaces.items() %}
            <option value="{{ iface_id }}" {% if default_route_iface and iface_id == default_route_iface %}selected{% endif %}>
              {{ iface_id }} ({{ iface_name }})
              {% if iface_id in interface_gateways %}
                â†’ Ú¯ÛŒØªâ€ŒÙˆÛŒ: {{ interface_gateways[iface_id]['gateway'] }}
              {% endif %}
            </option>
          {% endfor %}
        </select>
      </div>
      <button type="submit" name="change_default" class="btn btn-warning mt-2">Ø«Ø¨Øª Ø±ÙˆØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
    </form>

    <!-- Ø§Ø±ØªØ¨Ø§Ø· Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ Ø¨Ø§ Ø§ÛŒÙ†ØªØ±ÙÛŒØ³â€ŒÙ‡Ø§ -->
    <form method="POST">
      <h5>ğŸ“¶ Ø§Ø±ØªØ¨Ø§Ø· Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ Ø¨Ø§ Ø§ÛŒÙ†ØªØ±ÙÛŒØ³â€ŒÙ‡Ø§</h5>
      {% for table in tables %}
        {% if table.id != "main" %}
          <div class="row mb-2">
            <div class="col-md-4">
              <label class="form-label">{{ table.name }}</label>
            </div>
            <div class="col-md-4">
              <select name="interface_for_{{ table.id }}" class="form-select">
                {% for iface_id, iface_name in interfaces.items() %}
                  <option value="{{ iface_id }}" {% if table_interface_map.get(table.id) == iface_id %}selected{% endif %}>
                    {{ iface_name }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>
        {% endif %}
      {% endfor %}
      <button type="submit" name="update_table_interfaces" class="btn btn-success mt-3">Ø°Ø®ÛŒØ±Ù‡ Ø§Ø±ØªØ¨Ø§Ø·â€ŒÙ‡Ø§</button>
    </form>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/fontawesome.min.js"></script>
  <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
</body>
</html>
